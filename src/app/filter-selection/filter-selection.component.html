<div fxLayout="column" fxLayoutAlign="center center">
  <h1 style="margin-top: calc(75px + 5%)">
    Find the best surgical techniques using three simple criteria
  </h1>
  <mat-stepper
    [orientation]="(stepperOrientation | async)!"
    style="max-width: 800px; margin-bottom: 15px"
  >
    <mat-step label="Lesion region">
      <mat-form-field appearance="outline">
        <mat-label>Lesion region</mat-label>
        <mat-select required [(ngModel)]="lesionRegion">
          <!-- (selectionChange)="onRegionSelect($event)" -->
          <mat-option
            *ngFor="let region of lesionFilterService.regions"
            [value]="region"
          >
            {{ capitalizeFirstLetter(region) }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <div>
        <button mat-button matStepperNext>Next</button>
      </div>
    </mat-step>
    <mat-step label="Lesion subregion">
      <mat-form-field *ngIf="lesionRegion" appearance="outline">
        <mat-label>Lesion subregion</mat-label>
        <mat-select required [(ngModel)]="lesionSubregion">
          <!-- (selectionChange)="onSubregionSelect($event)" -->
          <mat-option
            *ngFor="
              let subregion of lesionFilterService.subregions(lesionRegion)
            "
            [value]="subregion"
          >
            {{ capitalizeFirstLetter(subregion) }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <p *ngIf="!lesionRegion">Please select the region of the lesion first.</p>
      <div>
        <button mat-button matStepperPrevious>Back</button>
        <button mat-button matStepperNext>Next</button>
      </div>
    </mat-step>
    <mat-step label="Lesion size">
      <mat-form-field
        *ngIf="lesionRegion && lesionSubregion"
        appearance="outline"
      >
        <mat-label>Lesion size</mat-label>
        <mat-select required [(ngModel)]="lesionSize">
          <!-- (selectionChange)="onSizeSelect($event)" -->
          <mat-option
            *ngFor="
              let size of lesionFilterService.sizes(
                lesionRegion,
                lesionSubregion
              )
            "
            [value]="size"
          >
            {{ capitalizeFirstLetter(size) }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <p *ngIf="!lesionRegion || !lesionSubregion">
        Please select region and subregion of the lesion first.
      </p>
      <div>
        <button mat-button matStepperPrevious>Back</button>
        <button mat-button matStepperNext>Next</button>
      </div>
    </mat-step>
    <mat-step>
      <ng-template matStepLabel>Done</ng-template>
      <p *ngIf="!lesionRegion || !lesionSubregion || !lesionSize">
        Please select region, subregion and size of the lesion first.
      </p>
      <div *ngIf="lesionRegion && lesionSubregion && lesionSize">
        <p>
          That's it! To find fitting techniques for lesions fitting your
          critera, click the button below.
        </p>
        <mat-list>
          <div mat-subheader>Selected lesion criteria</div>
          <mat-list-item>Region: {{ lesionRegion }}</mat-list-item>
          <mat-list-item> Subregion: {{ lesionSubregion }} </mat-list-item>
          <mat-list-item> Size: {{ lesionSize }} </mat-list-item>
        </mat-list>
        <button
          fxFlexFill
          mat-raised-button
          color="primary"
          (click)="onFindTechniques()"
        >
          Find techniques
        </button>
      </div>
      <div>
        <button mat-button matStepperPrevious>Back</button>
      </div>
    </mat-step>
  </mat-stepper>
</div>
<ng-container *ngIf="techniquesRequested">
  <mat-spinner
    *ngIf="!techniqueMetasFetched || !techniqueMetasFiltered"
  ></mat-spinner>
  <div
    *ngIf="techniqueMetasFetched && techniqueMetasFiltered"
    fxLayout="row wrap"
    fxLayoutAlign="space-around center"
    fxLayoutGap="10px grid"
  >
    <div *ngFor="let technique of filteredTechniqueMetas">
      <mat-card>
        <mat-card-header>
          <mat-card-title>{{ technique.name }}</mat-card-title>
          <mat-card-subtitle>By {{ technique.author }}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <p>{{ technique.stepIds.length }} Steps</p>
          <p class="truncated">{{ technique.description }}</p>
        </mat-card-content>
        <mat-card-actions>
          <button mat-button (click)="showTechniqueDetails(technique)">
            View
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>
</ng-container>
